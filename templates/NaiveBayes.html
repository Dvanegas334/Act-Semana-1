<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Naive Bayes - Caso Práctico</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">ML App</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item"><a class="nav-link active" href="/naivebayes">Naive Bayes</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">
  <div class="row">
    <div class="col-md-6">
      <h4>Descripción del dataset</h4>
      <p>Variables: mensaje (texto), prioridad (Baja/Media/Alta), palabras_clave (lista), hora (0-23).</p>
      <p>Clase positiva: categorías multiclass: Red / Hardware / Software / Usuario</p>
      <hr>
      <h5>Formulario de Predicción</h5>
      <form method="post" action="/naivebayes/predict">
        <div class="mb-3">
          <label class="form-label">Mensaje</label>
          <textarea class="form-control" name="mensaje" required rows="3"></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Prioridad</label>
          <select class="form-select" name="prioridad" required>
            <option value="Baja">Baja</option>
            <option value="Media">Media</option>
            <option value="Alta">Alta</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Palabras clave (separadas por coma)</label>
          <input class="form-control" name="palabras_clave" />
        </div>
        <div class="mb-3">
          <label class="form-label">Hora (0-23)</label>
          <input type="number" min="0" max="23" class="form-control" name="hora" value="9" required/>
        </div>
        <div class="mb-3">
          <label class="form-label">Umbral (opcional, 0-1)</label>
          <input type="number" step="0.01" min="0" max="1" class="form-control" name="threshold" placeholder="0.5"/>
        </div>
        <button class="btn btn-primary" type="submit">Predecir</button>
      </form>
    </div>
    <div class="col-md-6">
      <h4>Métricas (test)</h4>
      <!-- Aquí el servidor inyectará valores: exactitud, reporte, matriz -->
      {% if metrics %}
      <div class="card mb-3">
        <div class="card-body">
          <h5>Exactitud: {{ metrics.accuracy }}</h5>
        </div>
      </div>
      <h5>Reporte de clasificación</h5>
      <div class="table-responsive">
        <table class="table table-striped table-sm">
          <thead><tr><th>Clase</th><th>Precision</th><th>Recall</th><th>F1</th><th>Support</th></tr></thead>
          <tbody>
            {% for cls, vals in metrics.report.items() %}
              {% if cls != 'accuracy' and cls != 'macro avg' and cls != 'weighted avg' %}
              <tr>
                <td>{{ cls }}</td>
                <td>{{ '%.3f'|format(vals.precision) }}</td>
                <td>{{ '%.3f'|format(vals.recall) }}</td>
                <td>{{ '%.3f'|format(vals.f1-score) }}</td>
                <td>{{ vals.support }}</td>
              </tr>
              {% endif %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      <h5>Matriz de Confusión</h5>
      <img src="{{ url_for('static', filename=metrics.image.split('static/')[1]) }}" class="img-fluid" alt="Matriz de confusión">
      {% endif %}
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>